<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Ceasar Cipher</title>
    <script src="jquery-2.1.1.min.js"></script>
    <script src="http://crypto-js.googlecode.com/svn/tags/3.0.2/build/rollups/md5.js"></script>
    <script>

        $(function () {
            $('#cipher').click(function(){
                var encryptedText = $('#encryptedText');
                var plainText = $('#plainText');
                var code = $('#code');
                var hashText = $('#hashText');
                var messageText = $('#messageText');

                encryptedText.val(newCipher(plainText.val(), code.val()));

                hashText.val(makeHash(code.val().concat(encryptedText.val())));

                messageText.val("<enc"+hashText.val()+">"+encryptedText.val());
            });

            $('#decipher').click(function(){
                var encryptedText = $('#encryptedText');
                var plainText = $('#plainText');
                var code = $('#code');
                var hashText = $('#hashText');


                var key = false;
                key = isKey(code, hashText, encryptedText);

                if (key){
                    plainText.val(newDecipher(encryptedText.val(), code.val()));
                }
                else {
                    plainText.val("Decipher FAILED.");
                }

            });

            function makeHash(txt){
                return CryptoJS.MD5(txt);
            }

            function isKey(code, hashText, encryptedText){
                var tempHash = CryptoJS.MD5(code.val().concat(encryptedText.val()));

                if (tempHash == hashText.val()){
                    return true;
                }
                else return false;
            }

            function createCipher(code) {
                var len = code.length;
                var cipherVal = 0;

                for (var j = 0; j < len; j++){
                    cipherVal += code.charCodeAt(j);
                }
                return cipherVal % 94;
            }

            function newCipher(plainText, code){

                var keyLen = code.length;

                var cipherValues = new Array(0);

                for (var j = 0; j < keyLen; j++){
                    cipherValues[j] = createCipher(code.charAt(j));
                }

                //Cipher the text
                var len = plainText.length;

                var out = "";
                for (var i = 0; i < len; i++) {
                    if ((plainText.charCodeAt(i) + cipherValues[i % keyLen]) < 127) {
                        out = out.concat(String.fromCharCode(plainText.charCodeAt(i) + cipherValues[i % keyLen]));
                    }
                    else {
                        out = out.concat(String.fromCharCode(plainText.charCodeAt(i) + cipherValues[i % keyLen] - 94));
                    }
                }
                return out;
            }

            function newDecipher(plainText, code){

                var keyLen = code.length;

                var cipherValues = new Array(0);

                for (var j = 0; j < keyLen; j++){
                    cipherValues[j] = createCipher(code.charAt(j));
                }

                //Cipher the text
                var len = plainText.length;

                var out = "";
                for (var i = 0; i < len; i++) {
                    if ((plainText.charCodeAt(i) - cipherValues[i % keyLen]) > 31) {
                        out = out.concat(String.fromCharCode(plainText.charCodeAt(i) - cipherValues[i % keyLen]));
                    }
                    else {
                        out = out.concat(String.fromCharCode(plainText.charCodeAt(i) - cipherValues[i % keyLen] + 94));
                    }
                }
                return out;
            }




        })



    </script>
</head>

<body>

    <label for="code">Enter your cipher here:</label><br/>
    <textarea id="code" row="1" cols="65"></textarea><br/>

    <label for="plainText">Decrypted message here:</label><br/>
    <textarea id="plainText" rows="5" cols="65"></textarea><br/>

    <label for="encryptedText">Encrypted message here:</label><br/>
    <textarea id="encryptedText" rows="5" cols="65"></textarea><br/>

    <input id="cipher" type="button" value="Cipher text" /><br/>

    <input id="decipher" type="button" value="Decipher text" /><br/>

    <label for="hashText">Hashed message here:</label><br/>
    <textarea id="hashText" rows="5" cols="65"></textarea><br/>

    <label for="messageText">Full encrypted message here:</label><br/>
    <textarea id="messageText" rows="5" cols="65"></textarea><br/>

</body>

</html>